#!/bin/bash

# gets popcorn kernel repository
get-popcorn-kernel

# removes previous snippets
doas rm -rf /etc/kernel/config.d
doas mkdir -p /etc/kernel/config.d

# retrieves all snippets from a file
THIS_SNIPPETS=$(cat ${HOME}/.config/custom-kernel/kernel-snippets | sed '/^\s*#/d;/^\s*$/d')
# installs each snippet from the list
for THIS_SNIPPET in ${THIS_SNIPPETS}; do
  echo "Installing snippet: ${THIS_SNIPPET}..."
  cd ${HOME}/.config/popcorn-kernel
  THIS_SNIPPET_PWD=$(git ls-files | grep ${THIS_SNIPPET})
  doas cp ${THIS_SNIPPET_PWD} /etc/kernel/config.d
done
