#!/bin/sh

THIS_MIC=$(wpctl get-volume @DEFAULT_SOURCE@)
THIS_AUDIO=$(wpctl get-volume @DEFAULT_SINK@)

THIS_MIC_MUTED=$(echo $THIS_MIC | grep MUTED)
THIS_MIC_LEVEL=$(echo $THIS_MIC | awk '{print $NF}')

THIS_AUDIO_MUTED=$(echo $THIS_AUDIO | grep MUTED)
THIS_AUDIO_LEVEL=$(echo $THIS_AUDIO | awk '{print $NF}')

THIS_MIC_DATA=""
# detect mic level
if [ "$THIS_MIC_MUTED" == "" ]; then
    THIS_MIC_DATA_CALC=$(echo "$THIS_MIC_LEVEL * 100" | bc -l | grep -o "^\w*" | sed 's/$/%/g')
    THIS_MIC_DATA=""
    THIS_MIC_DATA+="${THIS_MIC_DATA_CALC}"
    THIS_MIC_DATA+=" "
    THIS_MIC_DATA+=""
    THIS_MIC_DATA+=" "
else
    # no mic
    THIS_MIC_DATA=""
    THIS_MIC_DATA+=""
    THIS_MIC_DATA+="  "
fi

THIS_AUDIO_DATA=""
# detect volume level
if [ "$THIS_AUDIO_MUTED" == "" ]; then
    THIS_AUDIO_DATA_CALC=$(echo "$THIS_AUDIO_LEVEL * 100" | bc -l | grep -o "^\w*" | sed 's/$/%/g')
    THIS_AUDIO_DATA=""
    THIS_AUDIO_DATA+="${THIS_AUDIO_DATA_CALC}"
    THIS_AUDIO_DATA+=" "
    THIS_AUDIO_DATA+=""
else
    # no audio
    THIS_AUDIO_DATA=""
fi

THIS_STATUS_AUDIO_DATA=""
THIS_STATUS_AUDIO_DATA+="${THIS_MIC_DATA}"
THIS_STATUS_AUDIO_DATA+="${THIS_AUDIO_DATA}"

export THIS_STATUS_AUDIO="${THIS_STATUS_AUDIO_DATA}"
